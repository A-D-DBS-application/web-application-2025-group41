
SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;


COMMENT ON SCHEMA "public" IS 'standard public schema';



CREATE EXTENSION IF NOT EXISTS "pg_graphql" WITH SCHEMA "graphql";






CREATE EXTENSION IF NOT EXISTS "pg_stat_statements" WITH SCHEMA "extensions";






CREATE EXTENSION IF NOT EXISTS "pgcrypto" WITH SCHEMA "extensions";






CREATE EXTENSION IF NOT EXISTS "supabase_vault" WITH SCHEMA "vault";






CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA "extensions";





SET default_tablespace = '';

SET default_table_access_method = "heap";


CREATE TABLE IF NOT EXISTS "public"."MACHINE_SIZE_CALC1" (
    "id" "uuid" DEFAULT "gen_random_uuid"() NOT NULL,
    "request_id" "uuid" NOT NULL,
    "recommended_machine_id" integer NOT NULL
);


ALTER TABLE "public"."MACHINE_SIZE_CALC1" OWNER TO "postgres";


CREATE TABLE IF NOT EXISTS "public"."MACHINE_SPECS" (
    "id" integer NOT NULL,
    "size_code" "text" NOT NULL,
    "capacity" integer NOT NULL,
    "selling_price" numeric(14,2) NOT NULL,
    "electricity_consumption" numeric(12,3) DEFAULT 0 NOT NULL,
    "water_consumption" numeric(12,3) DEFAULT 0 NOT NULL,
    CONSTRAINT "machine_specs_capacity_liters_check" CHECK (("capacity" > 0)),
    CONSTRAINT "machine_specs_selling_price_check" CHECK (("selling_price" >= (0)::numeric))
);


ALTER TABLE "public"."MACHINE_SPECS" OWNER TO "postgres";


CREATE TABLE IF NOT EXISTS "public"."PAYBACK_PERIOD_CALC2" (
    "id" "uuid" DEFAULT "gen_random_uuid"() NOT NULL,
    "request_id" "uuid" NOT NULL,
    "payback_months" numeric(14,6)
);


ALTER TABLE "public"."PAYBACK_PERIOD_CALC2" OWNER TO "postgres";


CREATE TABLE IF NOT EXISTS "public"."REQUEST" (
    "id" "uuid" DEFAULT "gen_random_uuid"() NOT NULL,
    "user_id" "uuid" NOT NULL,
    "created_at" timestamp with time zone DEFAULT "now"() NOT NULL
);


ALTER TABLE "public"."REQUEST" OWNER TO "postgres";


CREATE TABLE IF NOT EXISTS "public"."USER" (
    "id" "uuid" DEFAULT "gen_random_uuid"() NOT NULL,
    "name_user" character varying NOT NULL,
    "email" character varying NOT NULL,
    "company_number" bigint,
    "password" character varying NOT NULL,
    "name_organization" character varying,
    "position" character varying,
    "is_admin" boolean DEFAULT false NOT NULL,
    "confirm" character varying
);


ALTER TABLE "public"."USER" OWNER TO "postgres";


CREATE TABLE IF NOT EXISTS "public"."WASTE_PROFILE" (
    "id" "uuid" DEFAULT "gen_random_uuid"() NOT NULL,
    "request_id" "uuid" NOT NULL,
    "cost_collection_processing" numeric(14,2) NOT NULL,
    "hmw_total_weight" numeric(14,2) NOT NULL,
    "number_of_barrels_1" integer NOT NULL,
    "number_of_barrels_2" integer,
    "number_of_barrels_3" integer,
    "number_of_barrels_4" integer,
    "volume_barrels_1" integer NOT NULL,
    "volume_barrels_2" integer,
    "volume_barrels_3" integer,
    "volume_barrels_4" integer,
    "cost_hmw_barrels_1" numeric(14,2) NOT NULL,
    "cost_hmw_barrels_2" numeric(14,2),
    "cost_hmw_barrels_3" numeric(14,2),
    "cost_hmw_barrels_4" numeric(14,2),
    "total_cost_hmw_barrels" numeric(14,2) GENERATED ALWAYS AS ((((COALESCE("cost_hmw_barrels_1", (0)::numeric) + COALESCE("cost_hmw_barrels_2", (0)::numeric)) + COALESCE("cost_hmw_barrels_3", (0)::numeric)) + COALESCE("cost_hmw_barrels_4", (0)::numeric))) STORED NOT NULL,
    "steam_generator_needed" boolean DEFAULT false NOT NULL,
    "wiva_types" smallint,
    CONSTRAINT "waste_profile_cost_collection_check" CHECK (("cost_collection_processing" >= (0)::numeric))
);


ALTER TABLE "public"."WASTE_PROFILE" OWNER TO "postgres";


CREATE TABLE IF NOT EXISTS "public"."alembic_version" (
    "version_num" character varying(32) NOT NULL
);


ALTER TABLE "public"."alembic_version" OWNER TO "postgres";


CREATE SEQUENCE IF NOT EXISTS "public"."machine_specs_id_seq"
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE "public"."machine_specs_id_seq" OWNER TO "postgres";


ALTER SEQUENCE "public"."machine_specs_id_seq" OWNED BY "public"."MACHINE_SPECS"."id";



ALTER TABLE ONLY "public"."MACHINE_SPECS" ALTER COLUMN "id" SET DEFAULT "nextval"('"public"."machine_specs_id_seq"'::"regclass");



ALTER TABLE ONLY "public"."alembic_version"
    ADD CONSTRAINT "alembic_version_pkc" PRIMARY KEY ("version_num");



ALTER TABLE ONLY "public"."USER"
    ADD CONSTRAINT "app_user_email_key" UNIQUE ("email");



ALTER TABLE ONLY "public"."USER"
    ADD CONSTRAINT "app_user_pkey" PRIMARY KEY ("id");



ALTER TABLE ONLY "public"."MACHINE_SIZE_CALC1"
    ADD CONSTRAINT "machine_size_calc1_pkey" PRIMARY KEY ("id");



ALTER TABLE ONLY "public"."MACHINE_SIZE_CALC1"
    ADD CONSTRAINT "machine_size_calc1_request_id_key" UNIQUE ("request_id");



ALTER TABLE ONLY "public"."MACHINE_SPECS"
    ADD CONSTRAINT "machine_specs_pkey" PRIMARY KEY ("id");



ALTER TABLE ONLY "public"."PAYBACK_PERIOD_CALC2"
    ADD CONSTRAINT "payback_period_calc2_pkey" PRIMARY KEY ("id");



ALTER TABLE ONLY "public"."PAYBACK_PERIOD_CALC2"
    ADD CONSTRAINT "payback_period_calc2_request_id_key" UNIQUE ("request_id");



ALTER TABLE ONLY "public"."PAYBACK_PERIOD_CALC2"
    ADD CONSTRAINT "payback_period_calc2_request_id_uk" UNIQUE ("request_id");



ALTER TABLE ONLY "public"."REQUEST"
    ADD CONSTRAINT "request_pkey" PRIMARY KEY ("id");



ALTER TABLE ONLY "public"."WASTE_PROFILE"
    ADD CONSTRAINT "waste_profile_pkey" PRIMARY KEY ("id");



ALTER TABLE ONLY "public"."WASTE_PROFILE"
    ADD CONSTRAINT "waste_profile_request_id_key" UNIQUE ("request_id");



ALTER TABLE ONLY "public"."WASTE_PROFILE"
    ADD CONSTRAINT "waste_profile_request_uk" UNIQUE ("request_id");



CREATE INDEX "idx_calc1_machine" ON "public"."MACHINE_SIZE_CALC1" USING "btree" ("recommended_machine_id");



CREATE INDEX "idx_calc1_request" ON "public"."MACHINE_SIZE_CALC1" USING "btree" ("request_id");



CREATE INDEX "idx_request_user" ON "public"."REQUEST" USING "btree" ("user_id");



CREATE INDEX "idx_user_is_admin" ON "public"."USER" USING "btree" ("is_admin");



CREATE UNIQUE INDEX "uidx_machine_specs_size_code" ON "public"."MACHINE_SPECS" USING "btree" ("size_code");



ALTER TABLE ONLY "public"."PAYBACK_PERIOD_CALC2"
    ADD CONSTRAINT "calc2_request_refs_calc1_request_fk" FOREIGN KEY ("request_id") REFERENCES "public"."MACHINE_SIZE_CALC1"("request_id") ON DELETE CASCADE;



ALTER TABLE ONLY "public"."MACHINE_SIZE_CALC1"
    ADD CONSTRAINT "machine_size_calc1_recommended_machine_id_fkey" FOREIGN KEY ("recommended_machine_id") REFERENCES "public"."MACHINE_SPECS"("id") ON DELETE RESTRICT;



ALTER TABLE ONLY "public"."MACHINE_SIZE_CALC1"
    ADD CONSTRAINT "machine_size_calc1_request_id_fkey" FOREIGN KEY ("request_id") REFERENCES "public"."REQUEST"("id") ON DELETE CASCADE;



ALTER TABLE ONLY "public"."REQUEST"
    ADD CONSTRAINT "request_user_fk" FOREIGN KEY ("user_id") REFERENCES "public"."USER"("id") ON DELETE RESTRICT;



ALTER TABLE ONLY "public"."WASTE_PROFILE"
    ADD CONSTRAINT "waste_profile_request_fk" FOREIGN KEY ("request_id") REFERENCES "public"."REQUEST"("id") ON DELETE CASCADE;



ALTER TABLE ONLY "public"."WASTE_PROFILE"
    ADD CONSTRAINT "waste_profile_request_id_fkey" FOREIGN KEY ("request_id") REFERENCES "public"."REQUEST"("id") ON DELETE CASCADE;



ALTER TABLE "public"."MACHINE_SIZE_CALC1" ENABLE ROW LEVEL SECURITY;


ALTER TABLE "public"."MACHINE_SPECS" ENABLE ROW LEVEL SECURITY;


ALTER TABLE "public"."PAYBACK_PERIOD_CALC2" ENABLE ROW LEVEL SECURITY;


ALTER TABLE "public"."REQUEST" ENABLE ROW LEVEL SECURITY;


ALTER TABLE "public"."USER" ENABLE ROW LEVEL SECURITY;


ALTER TABLE "public"."WASTE_PROFILE" ENABLE ROW LEVEL SECURITY;


CREATE POLICY "calc1_insert_via_request" ON "public"."MACHINE_SIZE_CALC1" FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM "public"."REQUEST" "r"
  WHERE (("r"."id" = "MACHINE_SIZE_CALC1"."request_id") AND ("r"."user_id" = "auth"."uid"())))));



CREATE POLICY "calc1_select_via_request" ON "public"."MACHINE_SIZE_CALC1" FOR SELECT USING ((EXISTS ( SELECT 1
   FROM "public"."REQUEST" "r"
  WHERE (("r"."id" = "MACHINE_SIZE_CALC1"."request_id") AND ("r"."user_id" = "auth"."uid"())))));



CREATE POLICY "calc2_insert_via_request" ON "public"."PAYBACK_PERIOD_CALC2" FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM "public"."REQUEST" "r"
  WHERE (("r"."id" = "PAYBACK_PERIOD_CALC2"."request_id") AND ("r"."user_id" = "auth"."uid"())))));



CREATE POLICY "calc2_select_via_request" ON "public"."PAYBACK_PERIOD_CALC2" FOR SELECT USING ((EXISTS ( SELECT 1
   FROM "public"."REQUEST" "r"
  WHERE (("r"."id" = "PAYBACK_PERIOD_CALC2"."request_id") AND ("r"."user_id" = "auth"."uid"())))));



CREATE POLICY "machine_specs_read_all" ON "public"."MACHINE_SPECS" FOR SELECT USING (true);



CREATE POLICY "request_insert_own" ON "public"."REQUEST" FOR INSERT WITH CHECK (("user_id" = "auth"."uid"()));



CREATE POLICY "request_select_own" ON "public"."REQUEST" FOR SELECT USING (("user_id" = "auth"."uid"()));



CREATE POLICY "user_select_self" ON "public"."USER" FOR SELECT USING (("id" = "auth"."uid"()));



CREATE POLICY "waste_insert_via_request" ON "public"."WASTE_PROFILE" FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM "public"."REQUEST" "r"
  WHERE (("r"."id" = "WASTE_PROFILE"."request_id") AND ("r"."user_id" = "auth"."uid"())))));



CREATE POLICY "waste_select_via_request" ON "public"."WASTE_PROFILE" FOR SELECT USING ((EXISTS ( SELECT 1
   FROM "public"."REQUEST" "r"
  WHERE (("r"."id" = "WASTE_PROFILE"."request_id") AND ("r"."user_id" = "auth"."uid"())))));





ALTER PUBLICATION "supabase_realtime" OWNER TO "postgres";


GRANT USAGE ON SCHEMA "public" TO "postgres";
GRANT USAGE ON SCHEMA "public" TO "anon";
GRANT USAGE ON SCHEMA "public" TO "authenticated";
GRANT USAGE ON SCHEMA "public" TO "service_role";
